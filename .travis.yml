# travis.yml validator
# https://lint.travis-ci.org/PhysikOnline-FFM/tinyGU

# https://github.com/travis-ci/travis-ci/issues/2856#issuecomment-58609666
# with an empty .travis.yml   nothing works
# with only a script step     we assume ruby
# with language: generic      only the script step runs
# with language: c we set CC=gcc and run gcc --version, which is minimal, but still more than nothing

# https://loiane.com/2017/09/continuous-integration-with-angular-cli-travis-ci-firebase-greenkeeper-github/
# https://caveofcode.com/2017/05/publish-an-angular-app-to-github-pages/amp/

# https://medium.com/@cpavnn/deploy-to-firebase-hosting-from-github-3772fed05e72
# https://coryrylan.com/blog/deploy-angular-cli-apps-to-firebase

# actually thats just because of empty lines!!
# since travis interprets the windows newline as newline + '\n\ make sure the new lines are LF = \n and not CR LF = \r\n
# https://de.wikipedia.org/wiki/Zeilenumbruch#ASCII_und_EBCDIC
# to avoid that create .gitattributes with the line '.travis.yml  eol=lf'

# https://github.com/dwyl/learn-travis

language: node_js

node_js:
   - node # will use latest node

branches:
    except:
      - prototype
      - backend_prototype
      - mdl-prototype.discontinued
      - gh-pages
      - master.test
      - master.test1
      - /^(?=.*(?:dev|developement|test|patch))(?=.*(?:\.|-|\/|\\|_)).*$/
      - /^(?:dev|developement|test|patch)$/
      # the last two lines exclude all branches that contain one of the strings only
      # or seperated at beginning or end by .-_/\
#      - master
#      - /^greenkeeper/.*$/
#    only:
#      - master.ng5
#      - prototype

cache:
  directories:
    - node_modules

before_script: # commands to run before the build step
#   - npm install -g --silent @angular/cli
#   - npm install -g @angular/cli
#   - npm install --save @angular/material @angular/cdk
#   - npm install --save @angular/animations
#   - npm install @angular/flex-layout --save
   - npm install
   - chmod +x ./before_script.travis.sh
   - ./before_script.travis.sh $TRAVIS_REPO_SLUG

script: # the build step
   - ng build --prod --base-href "https://physikonline-ffm.github.io/tinyGU/"
#   - npm run build.prod

before_deploy:
   - chmod +x ./before_deploy.travis.sh
   - ./before_deploy.travis.sh

# http://www.backalleycoder.com/2016/05/13/sghpa-the-single-page-app-hack-for-github-pages/
# https://stackoverflow.com/questions/5411538/redirect-from-an-html-page

# get https://gist.github.com/ac3121fbc85ecdedd59b440b551dd02a.git
# https://stackoverflow.com/questions/13210880/replace-one-substring-for-another-string-in-shell-script
# https://stackoverflow.com/questions/2871181/replacing-some-characters-in-a-string-with-another-character
# https://stackoverflow.com/questions/47228723/how-to-pass-to-curl-file-with-replace-some-sequence
# http://tldp.org/LDP/abs/html/string-manipulation.html
# https://github.com/travis-ci/travis-ci/issues/2856#issuecomment-58609666
# https://github.com/codecov/example-bash/blob/master/.travis.yml
# https://www.ortussolutions.com/blog/build-test-and-deploy-your-module-with-travis-ci


deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN # Set in travis-ci.org dashboard
  local_dir: dist
  file:
  on:
#    branch: master
    all_branches: true

notifications:
  email: false
  slack:  # <USER>:<TOKEN>#<CHANNEL>
    rooms:
      # https://travis-encrypt.github.io/
      # travis encrypt "<account>:<token>" --add notifications.slack -r <accountName>/<repoName>
      # travis encrypt "<account>:<token>#<channel>" --add notifications.slack.rooms -r <accountName>/<repoName>
      secure: "hLne7ctE8Df9zD1NHlnf3shiXIvTQJR8sKyAirpORHn4oNT5u3Zjo9dNX5o+jimjlcbQTMl82BIEI6UguxFfFRXUQQV22pRdecajSRm+FgQ5r9WyV4/luHR7cByrMUbznpatirrUE5c9oHMqqvtlUfyNZOtaa010UKJcG4ssyxkVva/OMbBPVNK566v0o/Uccq/kbjcvthqDcqZ4b0B4cwL3nhP24xkLT/9xhe9xSMfI3HiFvRLypf+y4wBKzcdIzRdSMYJTQPyRXAPzF2NbbgVxDBHrWnj7DKZ8H2A8RUYrMeGbWlqEyIrmIL7k5uSyk7am5PFX4nV/mZRBIrhxNxca2rh44bQVzaPjRmxCuL+FO6mveWQF8G3Rb1yZvb+VXpv18QAxbOjKSps6YDxMZIsVTU/2lBeOf3VoP1GfDH9cT1CLQwn4Jfr33VMthX4HO9bnf4SP+ZNIuSPDw3ZB/qh0q63YUENv7MQTX2qiLgQoZOdHBO+nOmroQ1rKSVPXbYzyJcmyr5PgTjbWJVRyt5mggWTIxljhEpAha+GrxxxfTlZRCGs9f9tBStrbdHy6jvf1QIy5HaViKPKnHPh+0352IcWjnMnyCy132QBFEnadM98TvvEcKB5t0X5DVR1auF3C/xFmogVgQp2uXduU3ebVb9BIXdYnhscwWHFiRgE="
      on_start: always
      on_failure: always
      on_success: always
      on_cancel: always
      on_error: always
      on_pull_requests: always
